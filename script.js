// Library data with folder structure
const library = {
    type: 'folder',
    name: 'Root',
    items: [
        {
            type: 'folder',
            name: 'XXXTENTACION',
            cover: "images/Xxxtentacion.jpg",
            items: [
                {
                    type: 'song',
                    title: "0c3an Clip",
                    artist: "XXXTENTACION",
                    album: "Single",
                    file: "all-songs/XXXTANTACION/0c3anclip.mp3",
                    cover: "images/Xxxtentacion.jpg"
                },
                {
                    type: 'song',
                    title: "Alone Part 1",
                    artist: "XXXTENTACION",
                    album: "Single",
                    file: "all-songs/XXXTANTACION/alonepart1.mp3",
                    cover: "images/Xxxtentacion.jpg"
                },
                {
                    type: 'song',
                    title: "Alone Part 2",
                    artist: "XXXTENTACION",
                    album: "Single",
                    file: "all-songs/XXXTANTACION/alonepart2.mp3",
                    cover: "images/Xxxtentacion.jpg"
                },
                {
                    type: 'song',
                    title: "Amy Winehouse",
                    artist: "XXXTENTACION",
                    album: "Single",
                    file: "all-songs/XXXTANTACION/amywinehouse.mp3",
                    cover: "images/Xxxtentacion.jpg"
                },
                {
                    type: 'song',
                    title: "Ayala (Outro)",
                    artist: "XXXTENTACION",
                    album: "17",
                    file: "all-songs/XXXTANTACION/ayalaoutroaudio.mp3",
                    cover: "images/Xxxtentacion.jpg"
                },
                {
                    type: 'song',
                    title: "Bitch Call Me Captain Morgan",
                    artist: "XXXTENTACION",
                    album: "Single",
                    file: "all-songs/XXXTANTACION/-bitchcallmecaptainmorgan.mp3",
                    cover: "images/Xxxtentacion.jpg"
                },
                {
                    type: 'song',
                    title: "Blood Stains (ft. Ki Mask & Drugz)",
                    artist: "XXXTENTACION",
                    album: "Single",
                    file: "all-songs/XXXTANTACION/bloodstainsft.kimaskdrugzprod.cokey.mp3",
                    cover: "images/Xxxtentacion.jpg"
                },
                {
                    type: 'song',
                    title: "Bricks",
                    artist: "XXXTENTACION",
                    album: "Single",
                    file: "all-songs/XXXTANTACION/bricks.mp3",
                    cover: "images/Xxxtentacion.jpg"
                },
                {
                    type: 'song',
                    title: "Carry On",
                    artist: "XXXTENTACION",
                    album: "17",
                    file: "all-songs/XXXTANTACION/carryonaudio.mp3",
                    cover: "images/Xxxtentacion.jpg"
                },
                {
                    type: 'song',
                    title: "Changes",
                    artist: "XXXTENTACION",
                    album: "?",
                    file: "all-songs/XXXTANTACION/changes.mp3",
                    cover: "images/Xxxtentacion.jpg"
                },
                {
                    type: 'song',
                    title: "Dead",
                    artist: "XXXTENTACION",
                    album: "Single",
                    file: "all-songs/XXXTANTACION/dead.mp3",
                    cover: "images/Xxxtentacion.jpg"
                },
                {
                    type: 'song',
                    title: "Dead Inside (Interlude)",
                    artist: "XXXTENTACION",
                    album: "17",
                    file: "all-songs/XXXTANTACION/deadinsideinterludeaudio.mp3",
                    cover: "images/Xxxtentacion.jpg"
                },
                {
                    type: 'song',
                    title: "Depression & Obsession",
                    artist: "XXXTENTACION",
                    album: "17",
                    file: "all-songs/XXXTANTACION/depressionobsessionaudio.mp3",
                    cover: "images/Xxxtentacion.jpg"
                },
                {
                    type: 'song',
                    title: "Elephant In The Room (Acoustic)",
                    artist: "XXXTENTACION",
                    album: "Single",
                    file: "all-songs/XXXTANTACION/elephantintheroomacoustic.mp3",
                    cover: "images/Xxxtentacion.jpg"
                },
                {
                    type: 'song',
                    title: "Everybody Dies In Their Nightmares",
                    artist: "XXXTENTACION",
                    album: "17",
                    file: "all-songs/XXXTANTACION/everybodydiesintheirnightmaresaudio.mp3",
                    cover: "images/Xxxtentacion.jpg"
                },
                {
                    type: 'song',
                    title: "Find Me",
                    artist: "XXXTENTACION",
                    album: "Single",
                    file: "all-songs/XXXTANTACION/findme.mp3",
                    cover: "images/Xxxtentacion.jpg"
                },
                {
                    type: 'song',
                    title: "Garette's Revenge",
                    artist: "XXXTENTACION",
                    album: "Revenge",
                    file: "all-songs/XXXTANTACION/garettesrevengewshhexclusive-officialaudio.mp3",
                    cover: "images/Xxxtentacion.jpg"
                },
                {
                    type: 'song',
                    title: "Hate Will Never Win",
                    artist: "XXXTENTACION",
                    album: "Single",
                    file: "all-songs/XXXTANTACION/hatewillneverwin.mp3",
                    cover: "images/Xxxtentacion.jpg"
                },
                {
                    type: 'song',
                    title: "I Am! (Snippet)",
                    artist: "XXXTENTACION",
                    album: "Single",
                    file: "all-songs/XXXTANTACION/iam(snippet).mp3",
                    cover: "images/Xxxtentacion.jpg"
                },
                {
                    type: 'song',
                    title: "I Don't Wanna Do This Anymore",
                    artist: "XXXTENTACION",
                    album: "Revenge",
                    file: "all-songs/XXXTANTACION/idontwannadothisanymore.mp3",
                    cover: "images/Xxxtentacion.jpg"
                },
                {
                    type: 'song',
                    title: "I Spoke To The Devil In Miami, He Said Everything Would Be Fine",
                    artist: "XXXTENTACION",
                    album: "ItWasntEnough",
                    file: "all-songs/XXXTANTACION/ispoketothedevilinmiami,hesaideverythingwouldbefine.mp3",
                    cover: "images/Xxxtentacion.jpg"
                },
                {
                    type: 'song',
                    title: "Ice Hotel (ft. Sza)",
                    artist: "XXXTENTACION",
                    album: "Single",
                    file: "all-songs/XXXTANTACION/icehotelfeat.sza.mp3",
                    cover: "images/Xxxtentacion.jpg"
                },
                {
                    type: 'song',
                    title: "Inuyasha",
                    artist: "XXXTENTACION",
                    album: "Single",
                    file: "all-songs/XXXTANTACION/-inuyasha.mp3",
                    cover: "images/Xxxtentacion.jpg"
                },
                {
                    type: 'song',
                    title: "Jocelyn Flores",
                    artist: "XXXTENTACION",
                    album: "17",
                    file: "all-songs/XXXTANTACION/jocelynfloresaudio.mp3",
                    cover: "images/Xxxtentacion.jpg"
                },
                {
                    type: 'song',
                    title: "King",
                    artist: "XXXTENTACION",
                    album: "Revenge",
                    file: "all-songs/XXXTANTACION/kingaudio.mp3",
                    cover: "images/Xxxtentacion.jpg"
                },
                {
                    type: 'song',
                    title: "King Of The Dead",
                    artist: "XXXTENTACION",
                    album: "Single",
                    file: "all-songs/XXXTANTACION/kingofthedeadlyrics.mp3",
                    cover: "images/Xxxtentacion.jpg"
                },
                {
                    type: 'song',
                    title: "Let's Pretend We're Numb",
                    artist: "XXXTENTACION",
                    album: "Single",
                    file: "all-songs/XXXTANTACION/letspretendwerenumblyricscc.mp3",
                    cover: "images/Xxxtentacion.jpg"
                },
                {
                    type: 'song',
                    title: "Looking For A Star",
                    artist: "XXXTENTACION",
                    album: "Revenge",
                    file: "all-songs/XXXTANTACION/lookingforastaraudio.mp3",
                    cover: "images/Xxxtentacion.jpg"
                },
                {
                    type: 'song',
                    title: "Manikin",
                    artist: "XXXTENTACION",
                    album: "Single",
                    file: "all-songs/XXXTANTACION/manikin.mp3",
                    cover: "images/Xxxtentacion.jpg"
                },
                {
                    type: 'song',
                    title: "Members Only Be The Click",
                    artist: "XXXTENTACION",
                    album: "Single",
                    file: "all-songs/XXXTANTACION/membersonlybetheclick.mp3",
                    cover: "images/Xxxtentacion.jpg"
                },
                {
                    type: 'song',
                    title: "Never",
                    artist: "XXXTENTACION",
                    album: "Single",
                    file: "all-songs/XXXTANTACION/neverprod.xxx.mp3",
                    cover: "images/Xxxtentacion.jpg"
                },
                {
                    type: 'song',
                    title: "Okage The Shadow King",
                    artist: "XXXTENTACION",
                    album: "Single",
                    file: "all-songs/XXXTANTACION/okagetheshadowking.mp3",
                    cover: "images/Xxxtentacion.jpg"
                },
                {
                    type: 'song',
                    title: "Orlando",
                    artist: "XXXTENTACION",
                    album: "17",
                    file: "all-songs/XXXTANTACION/orlandoaudio.mp3",
                    cover: "images/Xxxtentacion.jpg"
                },
                {
                    type: 'song',
                    title: "Revenge",
                    artist: "XXXTENTACION",
                    album: "17",
                    file: "all-songs/XXXTANTACION/revengeaudio.mp3",
                    cover: "images/Xxxtentacion.jpg"
                },
                {
                    type: 'song',
                    title: "Riot",
                    artist: "XXXTENTACION",
                    album: "Single",
                    file: "all-songs/XXXTANTACION/riotlyricsonscreen.mp3",
                    cover: "images/Xxxtentacion.jpg"
                },
                {
                    type: 'song',
                    title: "Rip Roach (ft. Ski Mask The Slump God)",
                    artist: "XXXTENTACION",
                    album: "Revenge",
                    file: "all-songs/XXXTANTACION/riproachaudiofeat.kimasktheslumpgod.mp3",
                    cover: "images/Xxxtentacion.jpg"
                },
                {
                    type: 'song',
                    title: "Run",
                    artist: "XXXTENTACION",
                    album: "Single",
                    file: "all-songs/XXXTANTACION/run.mp3",
                    cover: "images/Xxxtentacion.jpg"
                },
                {
                    type: 'song',
                    title: "Run Up On Me",
                    artist: "XXXTENTACION",
                    album: "Single",
                    file: "all-songs/XXXTANTACION/runuponme.mp3",
                    cover: "images/Xxxtentacion.jpg"
                },
                {
                    type: 'song',
                    title: "Sad!",
                    artist: "XXXTENTACION",
                    album: "?",
                    file: "all-songs/XXXTANTACION/sad.mp3",
                    cover: "images/Xxxtentacion.jpg"
                },
                {
                    type: 'song',
                    title: "Save Me",
                    artist: "XXXTENTACION",
                    album: "17",
                    file: "all-songs/XXXTANTACION/savemeaudio.mp3",
                    cover: "images/Xxxtentacion.jpg"
                },
                {
                    type: 'song',
                    title: "Slipknot (ft. Kinoul & Killstation)",
                    artist: "XXXTENTACION",
                    album: "Revenge",
                    file: "all-songs/XXXTANTACION/slipknotaudiofeat.kinoulkillstation.mp3",
                    cover: "images/Xxxtentacion.jpg"
                },
                {
                    type: 'song',
                    title: "Snow",
                    artist: "XXXTENTACION",
                    album: "Single",
                    file: "all-songs/XXXTANTACION/snow.mp3",
                    cover: "images/Xxxtentacion.jpg"
                },
                {
                    type: 'song',
                    title: "The Boy With The Black Eyes",
                    artist: "XXXTENTACION",
                    album: "Single",
                    file: "all-songs/XXXTANTACION/theboywiththeblackeyes.mp3",
                    cover: "images/Xxxtentacion.jpg"
                },
                {
                    type: 'song',
                    title: "The Fall",
                    artist: "XXXTENTACION",
                    album: "Single",
                    file: "all-songs/XXXTANTACION/-thefall.mp3",
                    cover: "images/Xxxtentacion.jpg"
                },
                {
                    type: 'song',
                    title: "Tightrope (ft. Scott James)",
                    artist: "XXXTENTACION",
                    album: "Revenge",
                    file: "all-songs/XXXTANTACION/tightropefeat.scottjames.mp3",
                    cover: "images/Xxxtentacion.jpg"
                },
                {
                    type: 'song',
                    title: "Valentine",
                    artist: "XXXTENTACION",
                    album: "Revenge",
                    file: "all-songs/XXXTANTACION/valentine.mp3",
                    cover: "images/Xxxtentacion.jpg"
                },
                {
                    type: 'song',
                    title: "Vice City",
                    artist: "XXXTENTACION",
                    album: "Single",
                    file: "all-songs/XXXTANTACION/vicecitylyrics.mp3",
                    cover: "images/Xxxtentacion.jpg"
                },
                {
                    type: 'song',
                    title: "What If",
                    artist: "XXXTENTACION",
                    album: "Single",
                    file: "all-songs/XXXTANTACION/whatif.mp3",
                    cover: "images/Xxxtentacion.jpg"
                },
                {
                    type: 'song',
                    title: "White Girl",
                    artist: "XXXTENTACION",
                    album: "Single",
                    file: "all-songs/XXXTANTACION/whitegirl.mp3",
                    cover: "images/Xxxtentacion.jpg"
                },
                {
                    type: 'song',
                    title: "Wing Ridden Angel",
                    artist: "XXXTENTACION",
                    album: "Single",
                    file: "all-songs/XXXTANTACION/wingriddenangellyrics.mp3",
                    cover: "images/Xxxtentacion.jpg"
                },
                {
                    type: 'song',
                    title: "X (ft. Wifisfuneral) - Don't Test Me (Remix)",
                    artist: "XXXTENTACION",
                    album: "Single",
                    file: "all-songs/XXXTANTACION/xwifisfuneral-donttestmeremix.mp3",
                    cover: "images/Xxxtentacion.jpg"
                },
                {
                    type: 'song',
                    title: "You Never Know",
                    artist: "XXXTENTACION",
                    album: "Single",
                    file: "all-songs/XXXTANTACION/youneverknow.mp3",
                    cover: "images/Xxxtentacion.jpg"
                },
                {
                    type: 'song',
                    title: "You're Thinking Too Much, Stop It",
                    artist: "XXXTENTACION",
                    album: "Single",
                    file: "all-songs/XXXTANTACION/yourethinkingtomuch,stopitprod.trbldboy.mp3",
                    cover: "images/Xxxtentacion.jpg"
                },
                {
                    type: 'song',
                    title: "Yung Bratz",
                    artist: "XXXTENTACION",
                    album: "Revenge",
                    file: "all-songs/XXXTANTACION/yungbratz.mp3",
                    cover: "images/Xxxtentacion.jpg"
                }
            ]
        },
        {
            type: 'folder',
            name: 'Juice WRLD',
            cover: "images/Juice_wrld.jpg",
            items: [
                {
                    type: 'song',
                    title: "Armed And Dangerous",
                    artist: "Juice WRLD",
                    album: "Single",
                    file: "all-songs/Juice WRLD/armedanddangerous.mp3",
                    cover: "images/Juice_wrld.jpg"
                },
                {
                    type: 'song',
                    title: "Can't Die",
                    artist: "Juice WRLD",
                    album: "Single",
                    file: "all-songs/Juice WRLD/cantdie.mp3",
                    cover: "images/Juice_wrld.jpg"
                },
                {
                    type: 'song',
                    title: "Come & Go",
                    artist: "Juice WRLD",
                    album: "Legends Never Die",
                    file: "all-songs/Juice WRLD/comego.mp3",
                    cover: "images/Juice_wrld.jpg"
                },
                {
                    type: 'song',
                    title: "Conversations",
                    artist: "Juice WRLD",
                    album: "Legends Never Die",
                    file: "all-songs/Juice WRLD/conversations.mp3",
                    cover: "images/Juice_wrld.jpg"
                },
                {
                    type: 'song',
                    title: "Hate The Other Side",
                    artist: "Juice WRLD",
                    album: "Legends Never Die",
                    file: "all-songs/Juice WRLD/hatetheotherside.mp3",
                    cover: "images/Juice_wrld.jpg"
                },
                {
                    type: 'song',
                    title: "Hide",
                    artist: "Juice WRLD",
                    album: "Spider-Man: Into the Spider-Verse",
                    file: "all-songs/Juice WRLD/hide.mp3",
                    cover: "images/Juice_wrld.jpg"
                },
                {
                    type: 'song',
                    title: "I Want It",
                    artist: "Juice WRLD",
                    album: "Legends Never Die",
                    file: "all-songs/Juice WRLD/iwantit.mp3",
                    cover: "images/Juice_wrld.jpg"
                },
                {
                    type: 'song',
                    title: "I'm Still",
                    artist: "Juice WRLD",
                    album: "Goodbye & Good Riddance",
                    file: "all-songs/Juice WRLD/imstill.mp3",
                    cover: "images/Juice_wrld.jpg"
                },
                {
                    type: 'song',
                    title: "My X Was Poison",
                    artist: "Juice WRLD",
                    album: "Single",
                    file: "all-songs/Juice WRLD/juicewrldmyxwaspoisonofficialaudio.mp3",
                    cover: "images/Juice_wrld.jpg"
                },
                {
                    type: 'song',
                    title: "All Girls Are The Same",
                    artist: "Juice WRLD",
                    album: "Goodbye & Good Riddance",
                    file: "all-songs/Juice WRLD/juicewrldallgirlsarethesameofficialmusicvideo.mp3",
                    cover: "images/Juice_wrld.jpg"
                },
                {
                    type: 'song',
                    title: "Already Dead",
                    artist: "Juice WRLD",
                    album: "Fighting Demons",
                    file: "all-songs/Juice WRLD/juicewrldalreadydeadofficialvisualizer.mp3",
                    cover: "images/Juice_wrld.jpg"
                },
                {
                    type: 'song',
                    title: "Awful Times",
                    artist: "Juice WRLD",
                    album: "Single",
                    file: "all-songs/Juice WRLD/juicewrldawfultimesmusicvideo.mp3",
                    cover: "images/Juice_wrld.jpg"
                },
                {
                    type: 'song',
                    title: "Bad Energy",
                    artist: "Juice WRLD",
                    album: "Legends Never Die",
                    file: "all-songs/Juice WRLD/juicewrldbadenergyofficialaudio.mp3",
                    cover: "images/Juice_wrld.jpg"
                },
                {
                    type: 'song',
                    title: "Bandit",
                    artist: "Juice WRLD",
                    album: "Single",
                    file: "all-songs/Juice WRLD/juicewrldbanditlyricsoriginalnonbayb.mp3",
                    cover: "images/Juice_wrld.jpg"
                },
                {
                    type: 'song',
                    title: "Black & White",
                    artist: "Juice WRLD",
                    album: "Goodbye & Good Riddance",
                    file: "all-songs/Juice WRLD/juicewrldblackwhiteofficialaudio.mp3",
                    cover: "images/Juice_wrld.jpg"
                },
                {
                    type: 'song',
                    title: "Burn",
                    artist: "Juice WRLD",
                    album: "Fighting Demons",
                    file: "all-songs/Juice WRLD/juicewrldburnofficiallyricvideo.mp3",
                    cover: "images/Juice_wrld.jpg"
                },
                {
                    type: 'song',
                    title: "Candles",
                    artist: "Juice WRLD",
                    album: "Goodbye & Good Riddance",
                    file: "all-songs/Juice WRLD/juicewrldcandlesofficialvisualizer.mp3",
                    cover: "images/Juice_wrld.jpg"
                },
                {
                    type: 'song',
                    title: "Cigarettes",
                    artist: "Juice WRLD",
                    album: "Fighting Demons",
                    file: "all-songs/Juice WRLD/juicewrldcigarettesofficialvisualizer.mp3",
                    cover: "images/Juice_wrld.jpg"
                },
                {
                    type: 'song',
                    title: "Doom",
                    artist: "Juice WRLD",
                    album: "Fighting Demons",
                    file: "all-songs/Juice WRLD/juicewrlddoomofficiallyricvideo.mp3",
                    cover: "images/Juice_wrld.jpg"
                },
                {
                    type: 'song',
                    title: "Empty",
                    artist: "Juice WRLD",
                    album: "Death Race for Love",
                    file: "all-songs/Juice WRLD/juicewrldemptyofficialaudio.mp3",
                    cover: "images/Juice_wrld.jpg"
                },
                {
                    type: 'song',
                    title: "End Of The Road",
                    artist: "Juice WRLD",
                    album: "Goodbye & Good Riddance",
                    file: "all-songs/Juice WRLD/juicewrldendoftheroadofficialaudio.mp3",
                    cover: "images/Juice_wrld.jpg"
                },
                {
                    type: 'song',
                    title: "Fast",
                    artist: "Juice WRLD",
                    album: "Death Race for Love",
                    file: "all-songs/Juice WRLD/juicewrldfast.mp3",
                    cover: "images/Juice_wrld.jpg"
                },
                {
                    type: 'song',
                    title: "Feeling",
                    artist: "Juice WRLD",
                    album: "Death Race for Love",
                    file: "all-songs/Juice WRLD/juicewrldfeelingofficialaudio.mp3",
                    cover: "images/Juice_wrld.jpg"
                },
                {
                    type: 'song',
                    title: "Fighting Demons",
                    artist: "Juice WRLD",
                    album: "Legends Never Die",
                    file: "all-songs/Juice WRLD/juicewrldfightingdemonsofficialaudio.mp3",
                    cover: "images/Juice_wrld.jpg"
                },
                {
                    type: 'song',
                    title: "Flaws and Sins",
                    artist: "Juice WRLD",
                    album: "Death Race for Love",
                    file: "all-songs/Juice WRLD/juicewrldflawsandsinsofficialaudio.mp3",
                    cover: "images/Juice_wrld.jpg"
                },
                {
                    type: 'song',
                    title: "I'll Be Fine",
                    artist: "Juice WRLD",
                    album: "Goodbye & Good Riddance",
                    file: "all-songs/Juice WRLD/juicewrldillbefineofficialvisualizer.mp3",
                    cover: "images/Juice_wrld.jpg"
                },
                {
                    type: 'song',
                    title: "Maze",
                    artist: "Juice WRLD",
                    album: "Death Race for Love",
                    file: "all-songs/Juice WRLD/juicewrldmazeofficialaudio.mp3",
                    cover: "images/Juice_wrld.jpg"
                },
                {
                    type: 'song',
                    title: "Righteous",
                    artist: "Juice WRLD",
                    album: "Legends Never Die",
                    file: "all-songs/Juice WRLD/juicewrldrighteousofficialvideo.mp3",
                    cover: "images/Juice_wrld.jpg"
                },
                {
                    type: 'song',
                    title: "Robbery",
                    artist: "Juice WRLD",
                    album: "Death Race for Love",
                    file: "all-songs/Juice WRLD/juicewrldrobberyofficialaudio.mp3",
                    cover: "images/Juice_wrld.jpg"
                },
                {
                    type: 'song',
                    title: "Scared Of Love",
                    artist: "Juice WRLD",
                    album: "Goodbye & Good Riddance",
                    file: "all-songs/Juice WRLD/juicewrldscaredoflovewithinstrumentalbyghostloftofficialaudio.mp3",
                    cover: "images/Juice_wrld.jpg"
                },
                {
                    type: 'song',
                    title: "Screw Juice",
                    artist: "Juice WRLD",
                    album: "Death Race for Love",
                    file: "all-songs/Juice WRLD/juicewrldscrewjuiceofficialaudio.mp3",
                    cover: "images/Juice_wrld.jpg"
                },
                {
                    type: 'song',
                    title: "Special",
                    artist: "Juice WRLD",
                    album: "Single",
                    file: "all-songs/Juice WRLD/juicewrldspeciallyricsprod.redlimits.mp3",
                    cover: "images/Juice_wrld.jpg"
                },
                {
                    type: 'song',
                    title: "Stay High",
                    artist: "Juice WRLD",
                    album: "Legends Never Die",
                    file: "all-songs/Juice WRLD/juicewrldstayhighofficiallyricvideo.mp3",
                    cover: "images/Juice_wrld.jpg"
                },
                {
                    type: 'song',
                    title: "Up Up And Away",
                    artist: "Juice WRLD",
                    album: "Legends Never Die",
                    file: "all-songs/Juice WRLD/juicewrldupupandawayofficialaudio.mp3",
                    cover: "images/Juice_wrld.jpg"
                },
                {
                    type: 'song',
                    title: "Used To",
                    artist: "Juice WRLD",
                    album: "Goodbye & Good Riddance",
                    file: "all-songs/Juice WRLD/juicewrldusedtoofficialaudio.mp3",
                    cover: "images/Juice_wrld.jpg"
                },
                {
                    type: 'song',
                    title: "Who Shot Cupid",
                    artist: "Juice WRLD",
                    album: "Death Race for Love",
                    file: "all-songs/Juice WRLD/juicewrldwhoshotcupidofficialaudio.mp3",
                    cover: "images/Juice_wrld.jpg"
                },
                {
                    type: 'song',
                    title: "Wishing Well",
                    artist: "Juice WRLD",
                    album: "Legends Never Die",
                    file: "all-songs/Juice WRLD/juicewrldwishingwellofficialaudio.mp3",
                    cover: "images/Juice_wrld.jpg"
                },
                {
                    type: 'song',
                    title: "Wasted",
                    artist: "Juice WRLD",
                    album: "Goodbye & Good Riddance",
                    file: "all-songs/Juice WRLD/juicewrldwastedfeat.liluzivert.mp3",
                    cover: "images/Juice_wrld.jpg"
                },
                {
                    type: 'song',
                    title: "Smile",
                    artist: "Juice WRLD & The Weeknd",
                    album: "Legends Never Die",
                    file: "all-songs/Juice WRLD/juicewrldtheweekndsmileofficialvideo.mp3",
                    cover: "images/Juice_wrld.jpg"
                },
                {
                    type: 'song',
                    title: "Life's A Mess",
                    artist: "Juice WRLD ft. Halsey",
                    album: "Legends Never Die",
                    file: "all-songs/Juice WRLD/juicewrldft.halseylifesamessofficialvisualizer.mp3",
                    cover: "images/Juice_wrld.jpg"
                },
                {
                    type: 'song',
                    title: "Come & Go",
                    artist: "Juice WRLD ft. Marshmello",
                    album: "Legends Never Die",
                    file: "all-songs/Juice WRLD/juicewrldft.marshmellocomegoofficialaudio.mp3",
                    cover: "images/Juice_wrld.jpg"
                },
                {
                    type: 'song',
                    title: "Let Me Know (I Wonder Why Freestyle)",
                    artist: "Juice WRLD",
                    album: "Single",
                    file: "all-songs/Juice WRLD/juicewrldletmeknowiwonderwhyfreestyleofficialaudio.mp3",
                    cover: "images/Juice_wrld.jpg"
                },
                {
                    type: 'song',
                    title: "Lucid Dreams (Forget Me)",
                    artist: "Juice WRLD",
                    album: "Goodbye & Good Riddance",
                    file: "all-songs/Juice WRLD/juicewrldluciddreamsforgetmeofficialaudio.mp3",
                    cover: "images/Juice_wrld.jpg"
                },
                {
                    type: 'song',
                    title: "Moonlight",
                    artist: "Juice WRLD",
                    album: "Single",
                    file: "all-songs/Juice WRLD/juicewrldmoonlightofficialaudio.mp3",
                    cover: "images/Juice_wrld.jpg"
                },
                {
                    type: 'song',
                    title: "My Fault",
                    artist: "Juice WRLD",
                    album: "Single",
                    file: "all-songs/Juice WRLD/juicewrldmyfaultofficialaudio.mp3",
                    cover: "images/Juice_wrld.jpg"
                },
                {
                    type: 'song',
                    title: "Lean Wit Me",
                    artist: "Juice WRLD",
                    album: "Goodbye & Good Riddance",
                    file: "all-songs/Juice WRLD/leanwitme.mp3",
                    cover: "images/Juice_wrld.jpg"
                },
                {
                    type: 'song',
                    title: "Legends",
                    artist: "Juice WRLD",
                    album: "Single",
                    file: "all-songs/Juice WRLD/legends.mp3",
                    cover: "images/Juice_wrld.jpg"
                },
                {
                    type: 'song',
                    title: "Rich And Blind",
                    artist: "Juice WRLD",
                    album: "Single",
                    file: "all-songs/Juice WRLD/richandblind.mp3",
                    cover: "images/Juice_wrld.jpg"
                }
            ]
        },

        {
            type: 'folder',
            name: 'Riduls Favorites',
            cover: "images/riduls_fav.jpg",
            items: [
                {
                    type: 'song',
                    title: "All Girls Are The Same",
                    artist: "Juice WRLD",
                    album: "Goodbye & Good Riddance",
                    file: "all-songs/Juice WRLD/juicewrldallgirlsarethesameofficialmusicvideo.mp3",
                    cover: "images/Juice_wrld.jpg"
                },
                {
                    type: 'song',
                    title: "Lucid Dreams (Forget Me)",
                    artist: "Juice WRLD",
                    album: "Goodbye & Good Riddance",
                    file: "all-songs/Juice WRLD/juicewrldluciddreamsforgetmeofficialaudio.mp3",
                    cover: "images/Juice_wrld.jpg"
                },
                {
                    type: 'song',
                    title: "Wasted",
                    artist: "Juice WRLD",
                    album: "Goodbye & Good Riddance",
                    file: "all-songs/Juice WRLD/juicewrldwastedfeat.liluzivert.mp3",
                    cover: "images/Juice_wrld.jpg"
                },
            ]
        },
        
    ]
};

// Flatten all songs into a single array for easy access
const songs = [];
function flattenLibrary(folder) {
    folder.items.forEach(item => {
        if (item.type === 'folder') {
            flattenLibrary(item);
        } else {
            songs.push(item);
        }
    });
}
flattenLibrary(library);


// App state
let state = {};

function saveState() {
    localStorage.setItem('musicPlayerState', JSON.stringify(state));
}

function loadState() {
    const savedState = localStorage.getItem('musicPlayerState');
    if (savedState) {
        try {
            const parsedState = JSON.parse(savedState);
            state = Object.assign({}, getDefaultState(), parsedState);
            // Ensure currentPath is valid after loading
            if (!state.currentPath || !Array.isArray(state.currentPath) || state.currentPath.length === 0) {
                state.currentPath = [library.name];
            }
        } catch (e) {
            console.error("Failed to parse state, using default state", e);
            state = getDefaultState();
        }
    } else {
        state = getDefaultState();
    }
}

function getDefaultState() {
    return {
        currentSongIndex: 0,
        isPlaying: false,
        isShuffle: false,
        isRepeat: false,
        volume: 0.5,
        currentPlaylist: null,
        favorites: [],
        recentlyPlayed: [],
        playlists: [],
        currentPath: [library.name],
        navigationHistory: ['library']
    };
}

// DOM elements
const audio = new Audio();
const playBtn = document.getElementById('play-btn');
const prevBtn = document.getElementById('prev-btn');
const nextBtn = document.getElementById('next-btn');
const shuffleBtn = document.getElementById('shuffle-btn');
const repeatBtn = document.getElementById('repeat-btn');
const progressBar = document.getElementById('progress-bar');
const currentTimeEl = document.getElementById('current-time');
const durationEl = document.getElementById('duration');
const volumeBar = document.getElementById('volume-bar');
const favoriteBtn = document.getElementById('favorite-btn');
const nowPlayingTitle = document.getElementById('now-playing-title');
const nowPlayingArtist = document.getElementById('now-playing-artist');
const nowPlayingCover = document.getElementById('now-playing-cover');
const songListContainer = document.getElementById('song-list');
const favoritesListContainer = document.getElementById('favorites-list');
const recentListContainer = document.getElementById('recent-list');
const playlistSongListContainer = document.getElementById('playlist-song-list');
const searchResultsContainer = document.getElementById('search-results');
const searchInput = document.getElementById('search-input');
const menuItems = document.querySelectorAll('.menu li');
const contentSections = document.querySelectorAll('.content-section');
const playlistContainer = document.getElementById('playlist-container');
const createPlaylistBtn = document.getElementById('create-playlist');
const playlistModal = document.getElementById('playlist-modal');
const playlistNameInput = document.getElementById('playlist-name');
const savePlaylistBtn = document.getElementById('save-playlist');
const closeModalBtns = document.querySelectorAll('.close-modal');
const renamePlaylistBtn = document.getElementById('rename-playlist');
const deletePlaylistBtn = document.getElementById('delete-playlist');
const renameModal = document.getElementById('rename-modal');
const newPlaylistNameInput = document.getElementById('new-playlist-name');
const saveRenameBtn = document.getElementById('save-rename');
const playlistNameDisplay = document.getElementById('playlist-name-display');
const backToLibraryBtn = document.getElementById('back-to-library');
const backButton = document.getElementById('back-button');

// Initialize the app
function init() {
    loadState();
    const savedSection = localStorage.getItem('currentSection') || 'library';
    setupEventListeners();
    updatePlayerUI();
    renderPlaylists();
    audio.volume = state.volume;
    volumeBar.value = state.volume * 100;
    showSection(savedSection);
    // Add a beforeunload event listener to save the state
    window.addEventListener('beforeunload', saveState);
}

// Load songs and folders into the library
function loadSongs(folder) {
    songListContainer.innerHTML = '';
    folder.items.forEach((item) => {
        if (item.type === 'folder') {
            const folderCard = createFolderCard(item);
            songListContainer.appendChild(folderCard);
        } else {
            const songIndex = songs.indexOf(item);
            const isFavorite = state.favorites.includes(songIndex);
            const songCard = createSongCard(item, songIndex, isFavorite);
            songListContainer.appendChild(songCard);
        }
    });
}

// Create a folder card element
function createFolderCard(folder) {
    const folderCard = document.createElement('div');
    folderCard.className = 'song-card';
    folderCard.innerHTML = `
        <img src="${folder.cover}" class="song-cover" alt="${folder.name}">
        <div class="song-title-artist">
            <h3>${folder.name}</h3>
            <p>Folder</p>
        </div>
        <div class="song-album"></div>
        <div class="song-actions"></div>
    `;
    folderCard.addEventListener('click', () => {
        state.currentPath.push(folder.name);
        loadSongs(folder);
    });
    return folderCard;
}

// Create a song card element
function createSongCard(song, index, isFavorite = false) {
    const songCard = document.createElement('div');
    songCard.className = 'song-card';
    songCard.dataset.index = index;
    
    songCard.innerHTML = `
        <img src="${song.cover}" class="song-cover" alt="${song.title}">
        <div class="song-title-artist">
            <h3>${song.title}</h3>
            <p>${song.artist}</p>
        </div>
        <div class="song-album">${song.album}</div>
        <div class="song-actions">
            <button class="add-to-playlist" data-index="${index}">
                <i class="fas fa-plus"></i>
            </button>
            <button class="favorite-btn" data-index="${index}">
                <i class="${isFavorite ? 'fas' : 'far'} fa-heart"></i>
            </button>
        </div>
    `;
    
    songCard.addEventListener('click', (e) => {
        if (!e.target.closest('.song-actions')) {
            playSong(index);
        }
    });
    
    return songCard;
}

// Setup event listeners
function setupEventListeners() {
    // Back button
    backButton.addEventListener('click', () => {
        if (state.navigationHistory.length > 1) {
            state.navigationHistory.pop();
            const previousSection = state.navigationHistory[state.navigationHistory.length - 1];
            showSection(previousSection, false); // Don't push to history when going back
        }
    });

    backToLibraryBtn.addEventListener('click', () => {
        if (state.currentPath.length > 1) {
            state.currentPath.pop();
            showSection('library', false);
        } else {
            showSection('library');
        }
    });
    // Player controls
    playBtn.addEventListener('click', togglePlay);
    prevBtn.addEventListener('click', playPrevSong);
    nextBtn.addEventListener('click', playNextSong);
    shuffleBtn.addEventListener('click', toggleShuffle);
    repeatBtn.addEventListener('click', toggleRepeat);
    favoriteBtn.addEventListener('click', toggleFavorite);
    
    // Progress bar
    progressBar.addEventListener('input', setProgress);
    progressBar.addEventListener('change', setProgress);
    
    // Volume control
    volumeBar.addEventListener('input', setVolume);
    
    // Audio events
    audio.addEventListener('timeupdate', updateProgress);
    audio.addEventListener('ended', handleSongEnd);
    audio.addEventListener('loadedmetadata', updateDuration);
    
    // Search
    searchInput.addEventListener('input', handleSearch);
    
    // Menu navigation
    menuItems.forEach(item => {
        item.addEventListener('click', () => {
            const section = item.dataset.section;
            if (section === 'library') {
                // Reset path to root when clicking library from menu
                state.currentPath = [library.name];
            }
            showSection(section, true);
        });
    });
    
    // Playlist modals
    createPlaylistBtn.addEventListener('click', () => {
        playlistModal.style.display = 'flex';
        playlistNameInput.value = '';
    });
    
    savePlaylistBtn.addEventListener('click', createPlaylist);
    
    renamePlaylistBtn.addEventListener('click', () => {
        if (state.currentPlaylist !== null) {
            renameModal.style.display = 'flex';
            newPlaylistNameInput.value = state.playlists[state.currentPlaylist].name;
        }
    });
    
    saveRenameBtn.addEventListener('click', renamePlaylist);
    
    deletePlaylistBtn.addEventListener('click', deletePlaylist);
    
    closeModalBtns.forEach(btn => {
        btn.addEventListener('click', () => {
            playlistModal.style.display = 'none';
            renameModal.style.display = 'none';
        });
    });
    
    // Click outside modal to close
    window.addEventListener('click', (e) => {
        if (e.target === playlistModal) {
            playlistModal.style.display = 'none';
        }
        if (e.target === renameModal) {
            renameModal.style.display = 'none';
        }
    });
}

// Play a song
function playSong(index, playlist = null) {
    if (index < 0 || index >= songs.length) return;
    
    state.currentSongIndex = index;
    state.currentPlaylist = playlist;
    
    const song = songs[index];
    audio.src = song.file;
    audio.play();
    state.isPlaying = true;
    
    // Add to recently played if not already there
    if (!state.recentlyPlayed.includes(index)) {
        state.recentlyPlayed.unshift(index);
        if (state.recentlyPlayed.length > 10) {
            state.recentlyPlayed.pop();
        }
        localStorage.setItem('recentlyPlayed', JSON.stringify(state.recentlyPlayed));
    }
    
    updatePlayerUI();
    updateRecentlyPlayed();
    updatePlayingGlow();
}

// Toggle play/pause
function togglePlay() {
    if (state.isPlaying) {
        audio.pause();
    } else {
        if (audio.src) {
            audio.play();
        } else {
            playSong(0);
        }
    }
    state.isPlaying = !state.isPlaying;
    updatePlayerUI();
    updatePlayingGlow();
}

// Play previous song
function playPrevSong() {
    let newIndex;
    
    if (state.currentPlaylist !== null) {
        const playlist = state.playlists[state.currentPlaylist];
        const currentIndexInPlaylist = playlist.songs.indexOf(state.currentSongIndex);
        newIndex = currentIndexInPlaylist <= 0 ? 
            playlist.songs[playlist.songs.length - 1] : 
            playlist.songs[currentIndexInPlaylist - 1];
    } else {
        newIndex = state.currentSongIndex <= 0 ? 
            songs.length - 1 : 
            state.currentSongIndex - 1;
    }
    
    playSong(newIndex, state.currentPlaylist);
}

// Play next song
function playNextSong() {
    let newIndex;
    
    if (state.currentPlaylist !== null) {
        const playlist = state.playlists[state.currentPlaylist];
        const currentIndexInPlaylist = playlist.songs.indexOf(state.currentSongIndex);
        newIndex = currentIndexInPlaylist >= playlist.songs.length - 1 ? 
            playlist.songs[0] : 
            playlist.songs[currentIndexInPlaylist + 1];
    } else {
        newIndex = state.currentSongIndex >= songs.length - 1 ? 
            0 : 
            state.currentSongIndex + 1;
    }
    
    if (state.isShuffle && state.currentPlaylist === null) {
        newIndex = getRandomSongIndex();
    }
    
    playSong(newIndex, state.currentPlaylist);
}

// Get a random song index (excluding current song)
function getRandomSongIndex() {
    let newIndex;
    do {
        newIndex = Math.floor(Math.random() * songs.length);
    } while (newIndex === state.currentSongIndex && songs.length > 1);
    return newIndex;
}

// Handle song end
function handleSongEnd() {
    if (state.isRepeat) {
        audio.currentTime = 0;
        audio.play();
    } else {
        playNextSong();
    }
}

// Toggle shuffle
function toggleShuffle() {
    state.isShuffle = !state.isShuffle;
    shuffleBtn.classList.toggle('active-btn', state.isShuffle);
    localStorage.setItem('shuffle', state.isShuffle);
}

// Toggle repeat
function toggleRepeat() {
    state.isRepeat = !state.isRepeat;
    repeatBtn.classList.toggle('active-btn', state.isRepeat);
    localStorage.setItem('repeat', state.isRepeat);
}

// Toggle favorite
function toggleFavorite() {
    const index = state.currentSongIndex;
    const favoriteIndex = state.favorites.indexOf(index);
    
    if (favoriteIndex === -1) {
        state.favorites.push(index);
    } else {
        state.favorites.splice(favoriteIndex, 1);
    }
    
    localStorage.setItem('favorites', JSON.stringify(state.favorites));
    updatePlayerUI();
    updateFavoritesList();
    updateSongCardFavoriteStatus(index);
}

// Update favorite status on song card
function updateSongCardFavoriteStatus(index) {
    const isFavorite = state.favorites.includes(index);
    const favoriteBtn = document.querySelector(`.song-card[data-index="${index}"] .favorite-btn i`);
    if (favoriteBtn) {
        favoriteBtn.className = isFavorite ? 'fas fa-heart' : 'far fa-heart';
    }
}

// Set progress bar position
function setProgress() {
    const progress = (progressBar.value / 100) * audio.duration;
    audio.currentTime = progress;
}

// Update progress bar
function updateProgress() {
    const progress = (audio.currentTime / audio.duration) * 100;
    progressBar.value = isNaN(progress) ? 0 : progress;
    
    // Update current time
    currentTimeEl.textContent = formatTime(audio.currentTime);
}

// Update duration display
function updateDuration() {
    durationEl.textContent = formatTime(audio.duration);
}

// Set volume
function setVolume() {
    state.volume = volumeBar.value / 100;
    audio.volume = state.volume;
    localStorage.setItem('volume', state.volume);
}

// Format time (seconds to MM:SS)
function formatTime(seconds) {
    if (isNaN(seconds)) return '0:00';
    
    const minutes = Math.floor(seconds / 60);
    const secs = Math.floor(seconds % 60);
    return `${minutes}:${secs < 10 ? '0' : ''}${secs}`;
}

// Update player UI
function updatePlayerUI() {
    if (songs.length === 0) return;
    
    const song = songs[state.currentSongIndex];
    nowPlayingTitle.textContent = song.title;
    nowPlayingArtist.textContent = song.artist;
    nowPlayingCover.src = song.cover;
    
    // Update play/pause button
    playBtn.innerHTML = state.isPlaying ? '<i class="fas fa-pause"></i>' : '<i class="fas fa-play"></i>';
    
    // Update favorite button
    const isFavorite = state.favorites.includes(state.currentSongIndex);
    favoriteBtn.innerHTML = `<i class="${isFavorite ? 'fas' : 'far'} fa-heart"></i>`;
    favoriteBtn.classList.toggle('favorited', isFavorite);
    
    // Update shuffle/repeat buttons
    shuffleBtn.classList.toggle('active-btn', state.isShuffle);
    repeatBtn.classList.toggle('active-btn', state.isRepeat);
}

// Show a content section
function showSection(section, addToHistory = true) {
    if (addToHistory) {
        // Avoid pushing the same section consecutively
        if (state.navigationHistory[state.navigationHistory.length - 1] !== section) {
            state.navigationHistory.push(section);
        }
    }
    localStorage.setItem('currentSection', section);
    contentSections.forEach(sec => {
        sec.style.display = 'none';
    });
    
    menuItems.forEach(item => {
        item.classList.remove('active');
    });
    
    const sectionElement = document.getElementById(`${section}-section`);
    if (sectionElement) {
        sectionElement.style.display = 'block';
    }
    const menuItem = document.querySelector(`.menu li[data-section="${section}"]`);
    if (menuItem) {
        menuItem.classList.add('active');
    }
    
    switch (section) {
        case 'favorites':
            updateFavoritesList();
            break;
        case 'recent':
            updateRecentlyPlayed();
            break;
        case 'library':
            let currentFolder = library;
            // Traverse path to find current folder
            for (let i = 1; i < state.currentPath.length; i++) {
                const folderName = state.currentPath[i];
                const nextFolder = currentFolder.items.find(item => item.type === 'folder' && item.name === folderName);
                if (nextFolder) {
                    currentFolder = nextFolder;
                } else {
                    // Invalid path, reset to root
                    console.error(`Invalid folder path: ${state.currentPath.join('/')}`);
                    currentFolder = library;
                    state.currentPath = [library.name];
                    break;
                }
            }
            loadSongs(currentFolder);
            break;
    }
}

// Update favorites list
function updateFavoritesList() {
    favoritesListContainer.innerHTML = '';
    
    if (state.favorites.length === 0) {
        favoritesListContainer.innerHTML = '<p>No favorite songs yet.</p>';
        return;
    }
    
    state.favorites.forEach(index => {
        const song = songs[index];
        const isFavorite = true; // All songs in favorites are favorites
        const songCard = createSongCard(song, index, isFavorite);
        favoritesListContainer.appendChild(songCard);
    });
}

// Update recently played list
function updateRecentlyPlayed() {
    recentListContainer.innerHTML = '';
    
    if (state.recentlyPlayed.length === 0) {
        recentListContainer.innerHTML = '<p>No recently played songs.</p>';
        return;
    }
    
    state.recentlyPlayed.forEach(index => {
        const song = songs[index];
        const isFavorite = state.favorites.includes(index);
        const songCard = createSongCard(song, index, isFavorite);
        recentListContainer.appendChild(songCard);
    });
}

// Handle search
function handleSearch() {
    const query = searchInput.value.toLowerCase();
    
    if (query === '') {
        showSection('library');
        return;
    }
    
    const results = songs.filter(song => 
        song.title.toLowerCase().includes(query) ||
        song.artist.toLowerCase().includes(query) ||
        song.album.toLowerCase().includes(query)
    );
    
    searchResultsContainer.innerHTML = '';
    
    if (results.length === 0) {
        searchResultsContainer.innerHTML = '<p>No results found.</p>';
    } else {
        results.forEach((song, index) => {
            const originalIndex = songs.findIndex(s => s.title === song.title);
            const isFavorite = state.favorites.includes(originalIndex);
            const songCard = createSongCard(song, originalIndex, isFavorite);
            searchResultsContainer.appendChild(songCard);
        });
    }
    
    // Show search section
    contentSections.forEach(sec => {
        sec.style.display = 'none';
    });
    document.getElementById('search-section').style.display = 'block';
}

// Render playlists
function renderPlaylists() {
    playlistContainer.innerHTML = '';
    
    if (state.playlists.length === 0) {
        playlistContainer.innerHTML = '<p>No playlists yet.</p>';
        return;
    }
    
    state.playlists.forEach((playlist, index) => {
        const li = document.createElement('li');
        li.textContent = playlist.name;
        li.dataset.index = index;
        li.addEventListener('click', () => showPlaylist(index));
        playlistContainer.appendChild(li);
    });
}

// Show playlist
function showPlaylist(index) {
    const playlist = state.playlists[index];
    state.currentPlaylist = index;
    
    playlistNameDisplay.textContent = playlist.name;
    playlistSongListContainer.innerHTML = '';
    
    if (playlist.songs.length === 0) {
        playlistSongListContainer.innerHTML = '<p>This playlist is empty.</p>';
    } else {
        playlist.songs.forEach(songIndex => {
            const song = songs[songIndex];
            const isFavorite = state.favorites.includes(songIndex);
            const songCard = createSongCard(song, songIndex, isFavorite);
            playlistSongListContainer.appendChild(songCard);
        });
    }
    
    // Show playlist section
    showSection('playlist', true);
}

// Create a new playlist
function createPlaylist() {
    const name = playlistNameInput.value.trim();
    
    if (name === '') {
        alert('Please enter a playlist name');
        return;
    }
    
    const newPlaylist = {
        name: name,
        songs: []
    };
    
    state.playlists.push(newPlaylist);
    localStorage.setItem('playlists', JSON.stringify(state.playlists));
    
    renderPlaylists();
    playlistModal.style.display = 'none';
}

// Rename playlist
function renamePlaylist() {
    const newName = newPlaylistNameInput.value.trim();
    
    if (newName === '') {
        alert('Please enter a new playlist name');
        return;
    }
    
    if (state.currentPlaylist !== null) {
        state.playlists[state.currentPlaylist].name = newName;
        localStorage.setItem('playlists', JSON.stringify(state.playlists));
        
        playlistNameDisplay.textContent = newName;
        renderPlaylists();
        renameModal.style.display = 'none';
    }
}

// Delete playlist
function deletePlaylist() {
    if (state.currentPlaylist !== null && confirm('Are you sure you want to delete this playlist?')) {
        state.playlists.splice(state.currentPlaylist, 1);
        localStorage.setItem('playlists', JSON.stringify(state.playlists));
        
        state.currentPlaylist = null;
        renderPlaylists();
        
        // Show library section
        showSection('library', true);
    }
}

// Add song to playlist (delegated event listener)
document.addEventListener('click', (e) => {
    if (e.target.classList.contains('add-to-playlist') || e.target.closest('.add-to-playlist')) {
        const button = e.target.classList.contains('add-to-playlist') ? 
            e.target : e.target.closest('.add-to-playlist');
        const songIndex = parseInt(button.dataset.index);
        
        if (state.playlists.length === 0) {
            alert('Please create a playlist first');
            return;
        }
        
        // Create a simple dropdown to select playlist
        const dropdown = document.createElement('div');
        dropdown.className = 'playlist-dropdown';
        dropdown.style.position = 'absolute';
        dropdown.style.backgroundColor = 'var(--light-bg)';
        dropdown.style.borderRadius = '4px';
        dropdown.style.padding = '10px';
        dropdown.style.boxShadow = '0 2px 10px rgba(0,0,0,0.2)';
        dropdown.style.zIndex = '1000';
        
        state.playlists.forEach((playlist, index) => {
            const playlistItem = document.createElement('div');
            playlistItem.textContent = playlist.name;
            playlistItem.style.padding = '5px 10px';
            playlistItem.style.cursor = 'pointer';
            playlistItem.addEventListener('click', () => {
                if (!playlist.songs.includes(songIndex)) {
                    playlist.songs.push(songIndex);
                    localStorage.setItem('playlists', JSON.stringify(state.playlists));
                    if (state.currentPlaylist === index) {
                        showPlaylist(index);
                    }
                }
                dropdown.remove();
            });
            dropdown.appendChild(playlistItem);
        });
        
        button.appendChild(dropdown);
        
        // Close dropdown when clicking outside
        setTimeout(() => {
            const clickHandler = (e) => {
                if (!dropdown.contains(e.target) && e.target !== button) {
                    dropdown.remove();
                    document.removeEventListener('click', clickHandler);
                }
            };
            document.addEventListener('click', clickHandler);
        });
    }
    
    // Handle favorite button clicks in song cards
    if (e.target.classList.contains('favorite-btn') || e.target.closest('.favorite-btn')) {
        const button = e.target.classList.contains('favorite-btn') ? 
            e.target : e.target.closest('.favorite-btn');
        const songIndex = parseInt(button.dataset.index);
        
        const favoriteIndex = state.favorites.indexOf(songIndex);
        if (favoriteIndex === -1) {
            state.favorites.push(songIndex);
        } else {
            state.favorites.splice(favoriteIndex, 1);
        }
        
        localStorage.setItem('favorites', JSON.stringify(state.favorites));
        updatePlayerUI();
        updateFavoritesList();
        updateSongCardFavoriteStatus(songIndex);
    }
});

function updatePlayingGlow() {
    const allSongCards = document.querySelectorAll('.song-card');
    allSongCards.forEach(card => {
        card.classList.remove('playing');
    });

    if (state.isPlaying) {
        const playingCard = document.querySelector(`.song-card[data-index="${state.currentSongIndex}"]`);
        if (playingCard) {
            playingCard.classList.add('playing');
        }
    }
}

// Initialize the app
init();
